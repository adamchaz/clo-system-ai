
-- Create CLO Deals table if it doesn't exist
CREATE TABLE IF NOT EXISTS clo_deals (
    id SERIAL PRIMARY KEY,
    deal_id VARCHAR(20) UNIQUE NOT NULL,
    deal_name VARCHAR(100) NOT NULL,
    manager VARCHAR(100),
    issue_date DATE,
    maturity_date DATE,
    deal_size BIGINT,
    deal_status VARCHAR(20),
    num_assets INTEGER,
    total_collateral NUMERIC(15,2),
    avg_asset_size NUMERIC(15,2),
    warf_threshold INTEGER,
    weighted_avg_spread NUMERIC(8,6),
    analysis_date DATE,
    days_to_maturity INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);



-- Insert MAG CLO deals
INSERT INTO clo_deals (
    deal_id, deal_name, manager, issue_date, maturity_date, deal_size,
    deal_status, num_assets, total_collateral, avg_asset_size,
    warf_threshold, weighted_avg_spread, analysis_date, days_to_maturity
) VALUES
(
    'MAG6',
    'Magnetar MAG6 CLO',
    'Magnetar Capital',
    '2012-09-13',
    '2023-09-15',
    367750000,
    'Revolving',
    197,
    250964364.98,
    1273930.79,
    2720,
    0.044,
    '2016-03-23',
    2732
),
(
    'MAG7',
    'Magnetar MAG7 CLO',
    'Magnetar Capital',
    '2012-12-20',
    '2025-01-15',
    552000000,
    'Revolving',
    197,
    396689506.24,
    2013652.32,
    2910,
    0.0415,
    '2016-03-23',
    3220
),
(
    'MAG8',
    'Magnetar MAG8 CLO',
    'Magnetar Capital',
    '2014-05-15',
    '2026-04-15',
    558720000,
    'Revolving',
    197,
    353991206.60,
    1796909.68,
    2935,
    0.0395,
    '2016-03-23',
    3675
),
(
    'MAG9',
    'Magnetar MAG9 CLO',
    'Magnetar Capital',
    '2014-07-17',
    '2026-07-25',
    373200000,
    'Revolving',
    197,
    269868422.32,
    1369890.47,
    2835,
    0.0405,
    '2016-03-23',
    3776
),
(
    'MAG11',
    'Magnetar MAG11 CLO',
    'Magnetar Capital',
    '2014-12-18',
    '2027-01-18',
    507000000,
    'Revolving',
    197,
    386062387.89,
    1959707.55,
    2840,
    0.041,
    '2016-03-23',
    3953
),
(
    'MAG12',
    'Magnetar MAG12 CLO',
    'Magnetar Capital',
    '2015-03-12',
    '2027-04-15',
    564000000,
    'Revolving',
    197,
    442218734.77,
    2244765.15,
    2645,
    0.042,
    '2016-03-23',
    4040
),
(
    'MAG14',
    'Magnetar MAG14 CLO',
    'Magnetar Capital',
    '2015-06-25',
    '2028-07-18',
    493500000,
    'Revolving',
    197,
    386382654.49,
    1961333.27,
    2695,
    0.044,
    '2016-03-23',
    4500
),
(
    'MAG15',
    'Magnetar MAG15 CLO',
    'Magnetar Capital',
    '2015-11-18',
    '2027-10-25',
    559400000,
    'Revolving',
    197,
    499272434.85,
    2534377.84,
    2740,
    0.044,
    '2016-03-23',
    4233
),
(
    'MAG16',
    'Magnetar MAG16 CLO',
    'Magnetar Capital',
    '2015-12-18',
    '2028-01-18',
    460000000,
    'Revolving',
    197,
    435070886.06,
    2208481.66,
    2470,
    0.0365,
    '2016-03-23',
    4318
),
(
    'MAG17',
    'Magnetar MAG17 CLO',
    'Magnetar Capital',
    '2016-03-31',
    '2028-04-20',
    462400000,
    'Revolving',
    195,
    431157604.92,
    2211064.64,
    2740,
    0.044,
    '2016-03-23',
    4411
);


-- Alternative UPSERT version (PostgreSQL)
INSERT INTO clo_deals (
    deal_id, deal_name, manager, issue_date, maturity_date, deal_size,
    deal_status, num_assets, total_collateral, avg_asset_size,
    warf_threshold, weighted_avg_spread, analysis_date, days_to_maturity
) VALUES
(
    'MAG6',
    'Magnetar MAG6 CLO',
    'Magnetar Capital',
    '2012-09-13',
    '2023-09-15',
    367750000,
    'Revolving',
    197,
    250964364.98,
    1273930.79,
    2720,
    0.044,
    '2016-03-23',
    2732
),
(
    'MAG7',
    'Magnetar MAG7 CLO',
    'Magnetar Capital',
    '2012-12-20',
    '2025-01-15',
    552000000,
    'Revolving',
    197,
    396689506.24,
    2013652.32,
    2910,
    0.0415,
    '2016-03-23',
    3220
),
(
    'MAG8',
    'Magnetar MAG8 CLO',
    'Magnetar Capital',
    '2014-05-15',
    '2026-04-15',
    558720000,
    'Revolving',
    197,
    353991206.60,
    1796909.68,
    2935,
    0.0395,
    '2016-03-23',
    3675
),
(
    'MAG9',
    'Magnetar MAG9 CLO',
    'Magnetar Capital',
    '2014-07-17',
    '2026-07-25',
    373200000,
    'Revolving',
    197,
    269868422.32,
    1369890.47,
    2835,
    0.0405,
    '2016-03-23',
    3776
),
(
    'MAG11',
    'Magnetar MAG11 CLO',
    'Magnetar Capital',
    '2014-12-18',
    '2027-01-18',
    507000000,
    'Revolving',
    197,
    386062387.89,
    1959707.55,
    2840,
    0.041,
    '2016-03-23',
    3953
),
(
    'MAG12',
    'Magnetar MAG12 CLO',
    'Magnetar Capital',
    '2015-03-12',
    '2027-04-15',
    564000000,
    'Revolving',
    197,
    442218734.77,
    2244765.15,
    2645,
    0.042,
    '2016-03-23',
    4040
),
(
    'MAG14',
    'Magnetar MAG14 CLO',
    'Magnetar Capital',
    '2015-06-25',
    '2028-07-18',
    493500000,
    'Revolving',
    197,
    386382654.49,
    1961333.27,
    2695,
    0.044,
    '2016-03-23',
    4500
),
(
    'MAG15',
    'Magnetar MAG15 CLO',
    'Magnetar Capital',
    '2015-11-18',
    '2027-10-25',
    559400000,
    'Revolving',
    197,
    499272434.85,
    2534377.84,
    2740,
    0.044,
    '2016-03-23',
    4233
),
(
    'MAG16',
    'Magnetar MAG16 CLO',
    'Magnetar Capital',
    '2015-12-18',
    '2028-01-18',
    460000000,
    'Revolving',
    197,
    435070886.06,
    2208481.66,
    2470,
    0.0365,
    '2016-03-23',
    4318
),
(
    'MAG17',
    'Magnetar MAG17 CLO',
    'Magnetar Capital',
    '2016-03-31',
    '2028-04-20',
    462400000,
    'Revolving',
    195,
    431157604.92,
    2211064.64,
    2740,
    0.044,
    '2016-03-23',
    4411
)
ON CONFLICT (deal_id) 
DO UPDATE SET
    deal_name = EXCLUDED.deal_name,
    manager = EXCLUDED.manager,
    issue_date = EXCLUDED.issue_date,
    maturity_date = EXCLUDED.maturity_date,
    deal_size = EXCLUDED.deal_size,
    deal_status = EXCLUDED.deal_status,
    num_assets = EXCLUDED.num_assets,
    total_collateral = EXCLUDED.total_collateral,
    avg_asset_size = EXCLUDED.avg_asset_size,
    warf_threshold = EXCLUDED.warf_threshold,
    weighted_avg_spread = EXCLUDED.weighted_avg_spread,
    analysis_date = EXCLUDED.analysis_date,
    days_to_maturity = EXCLUDED.days_to_maturity,
    updated_at = CURRENT_TIMESTAMP;
