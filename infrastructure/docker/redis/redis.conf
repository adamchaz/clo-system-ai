# Redis Configuration for CLO Management System
# Optimized for correlation matrix caching and session storage

# Network and Security
bind 127.0.0.1 0.0.0.0
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300

# General Configuration
daemonize no
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile ""
databases 16

# Snapshotting (Persistence)
save 900 1      # Save after 900 seconds if at least 1 key changed
save 300 10     # Save after 300 seconds if at least 10 keys changed  
save 60 10000   # Save after 60 seconds if at least 10000 keys changed
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# Replication (if using Redis Sentinel in future)
replica-serve-stale-data yes
replica-read-only yes

# Memory Management
maxmemory 1gb
maxmemory-policy allkeys-lru  # Evict least recently used keys when memory limit reached

# Lazy Freeing
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no

# Append Only Mode (AOF) - Disabled for performance
appendonly no

# Slow Log
slowlog-log-slower-than 10000  # Log queries slower than 10ms
slowlog-max-len 128

# Client Connection Management
maxclients 1000
tcp-keepalive 300

# Advanced Configuration
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# HyperLogLog sparse representation
hll-sparse-max-bytes 3000

# Streams
stream-node-max-bytes 4096
stream-node-max-entries 100

# Active Rehashing
activerehashing yes

# Client Output Buffer Limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Client Query Buffer Limit
client-query-buffer-limit 1gb

# Protocol Max Bulk Length
proto-max-bulk-len 512mb

# Frequency for running the background tasks
hz 10

# Enable dynamic HZ
dynamic-hz yes

# AOF Rewrite Configuration (even though AOF is disabled)
aof-rewrite-incremental-fsync yes

# RDB Configuration
rdb-save-incremental-fsync yes

# LFU Configuration
lfu-log-factor 10
lfu-decay-time 1

# Custom Configuration for CLO System

# Key expiration for correlation cache (1 hour = 3600 seconds)
# This is handled in application code, but documented here

# Notification Configuration
notify-keyspace-events ""

# Command Renaming for Security (disable dangerous commands)
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_clo_2024"
rename-command SHUTDOWN "SHUTDOWN_clo_2024"
rename-command DEBUG ""
rename-command EVAL ""
rename-command SCRIPT ""

# Custom Comments for CLO System Usage:
# - Key pattern "corr:ASSET1:ASSET2" for correlation cache
# - Key pattern "scenario:MAG_X" for scenario parameter cache  
# - Key pattern "session:USER_ID" for user session storage
# - Key pattern "cache:portfolio:DEAL_ID" for portfolio metrics cache
# - TTL of 3600s (1 hour) for correlation data
# - TTL of 7200s (2 hours) for scenario data
# - TTL of 1800s (30 minutes) for portfolio metrics
# - TTL of 86400s (24 hours) for user sessions